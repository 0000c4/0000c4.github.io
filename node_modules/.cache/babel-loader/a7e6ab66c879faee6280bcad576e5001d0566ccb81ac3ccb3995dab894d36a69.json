{"ast":null,"code":"import { makeAutoObservable } from 'mobx';\nimport AuthService from '../services/auth-service';\nimport noteService from '../services/note-service';\nimport localdb from '../local_db/localdb';\nexport default class Store {\n  constructor() {\n    //auth data\n    this.user = {};\n    this.isAuth = false;\n    //notes data\n    this.notes = [];\n    this.searchedNotes = [];\n    makeAutoObservable(this);\n  }\n  setAuth(auth) {\n    this.isAuth = auth;\n  }\n  setUser(user) {\n    this.user = user;\n  }\n  setNotes(notes) {\n    this.notes = notes;\n  }\n  setSearchedNotes(notes) {\n    this.searchedNotes = notes;\n  }\n  async login(email, password) {\n    try {\n      const response = await AuthService.login(email, password);\n      console.log(response);\n      localStorage.setItem('token', response.accessToken);\n      this.setAuth(true);\n      this.setUser(response.user);\n      this.getNotes();\n    } catch (error) {\n      return error.response.data;\n    }\n  }\n  async registration(email, password, name) {\n    try {\n      const response = await AuthService.registration(email, password, name);\n      console.log(response);\n      localStorage.setItem('token', response.accessToken);\n      this.setAuth(true);\n      this.setUser(response.user);\n    } catch (error) {\n      return error.response.data;\n    }\n  }\n  async logout() {\n    try {\n      console.log('logout');\n      await AuthService.logout();\n      localStorage.removeItem('token');\n      this.setAuth(false);\n      this.setUser({});\n    } catch (error) {\n      console.log(error);\n    }\n  }\n  async checkAuth() {\n    try {\n      const response = await AuthService.checkAuth();\n      localStorage.setItem('token', response.accessToken);\n      this.setAuth(true);\n      this.setUser(response.user);\n      this.getNotes();\n    } catch (error) {}\n  }\n  async sendResetPasswordEmail(email) {\n    try {\n      const response = await AuthService.sendResetPasswordEmail(email);\n      console.log(response);\n    } catch (error) {\n      return error.response.data;\n    }\n  }\n\n  //notes\n  async getNotes() {\n    const LocalNotes = await localdb.getAll();\n    this.setNotes(LocalNotes);\n    noteService.get().then(res => {\n      //если сервер доступен удаляем заметку из notes и меняем ее на валидную\n      if (res.status == 200) {\n        res.data.forEach(async serverNote => {\n          //проходимся по каждой заметки из сервера и проверяем по _id есть ли она в локальной бд\n          const isSynced = LocalNotes.find(element => element._id == serverNote._id);\n          if (isSynced == undefined) await localdb.add({\n            ...serverNote,\n            status: sync\n          });\n        });\n      }\n    });\n  }\n  async editNote(note, sync) {\n    try {\n      //await service.noteChange(editedNote)\n      await noteService.edit(note);\n      let newArray = [];\n      for (let i in this.notes) {\n        if (this.notes[i]._id === note._id) {\n          newArray.push(note);\n        } else {\n          newArray.push(this.notes[i]);\n        }\n      }\n      this.setNotes(newArray);\n    } catch (error) {\n      console.log(error);\n    } finally {}\n  }\n  async AddNote(note, sync) {\n    try {\n      // setIsSync(true)\n      const localNote = {\n        ...note,\n        status: 'new',\n        _id: new Date()\n      }; //сначала создаем заметку в бд\n      await localdb.add(localNote);\n      this.setNotes([...this.notes, localNote]);\n      noteService.add(note).then(res => {\n        //если сервер доступен удаляем заметку из notes и меняем ее на валидную\n        if (res.status == 200) {\n          const syncNote = res.data;\n          const notes = this.notes.filter(e => e._id !== localNote._id);\n          localdb.delete(localNote._id);\n          localdb.add({\n            ...syncNote,\n            status: 'sync'\n          });\n          this.setNotes([...notes, syncNote]);\n        }\n      });\n    } catch (error) {\n      console.log(error);\n    } finally {\n      //setIsSync(false)\n    }\n  }\n  async RemoveNote(note, sync) {\n    try {\n      await noteService.delete(note);\n      const notes = this.notes.filter(e => e._id !== note._id);\n      this.setNotes(notes);\n    } catch (error) {}\n  }\n  NoteSearch(search) {\n    const notes = this.notes.filter(note => note.title.toLowerCase().includes(search.toLowerCase())).concat(this.notes.filter(note => note.body.toLowerCase().includes(search.toLowerCase())));\n    this.setSearchedNotes(notes);\n  }\n}","map":{"version":3,"names":["makeAutoObservable","AuthService","noteService","localdb","Store","constructor","user","isAuth","notes","searchedNotes","setAuth","auth","setUser","setNotes","setSearchedNotes","login","email","password","response","console","log","localStorage","setItem","accessToken","getNotes","error","data","registration","name","logout","removeItem","checkAuth","sendResetPasswordEmail","LocalNotes","getAll","get","then","res","status","forEach","serverNote","isSynced","find","element","_id","undefined","add","sync","editNote","note","edit","newArray","i","push","AddNote","localNote","Date","syncNote","filter","e","delete","RemoveNote","NoteSearch","search","title","toLowerCase","includes","concat","body"],"sources":["C:/Users/vasja/coding/notes_pwa/src/store/Store.js"],"sourcesContent":["import { makeAutoObservable } from 'mobx';\r\nimport AuthService from '../services/auth-service';\r\nimport noteService from '../services/note-service';\r\nimport localdb from '../local_db/localdb';\r\nexport default class Store {\r\n    //auth data\r\n    user = {};\r\n    isAuth = false;\r\n\r\n    //notes data\r\n    notes = [];\r\n    searchedNotes = [];\r\n\r\n    constructor() {\r\n        makeAutoObservable(this);\r\n    }\r\n\r\n    setAuth(auth) {\r\n        this.isAuth = auth;\r\n    }\r\n    setUser(user) {\r\n        this.user = user;\r\n    }\r\n\r\n    setNotes(notes) {\r\n        this.notes = notes;\r\n    }\r\n    setSearchedNotes(notes) {\r\n        this.searchedNotes = notes;\r\n    }\r\n\r\n    async login(email, password) {\r\n        try {\r\n            const response = await AuthService.login(email, password);\r\n            console.log(response);\r\n            localStorage.setItem('token', response.accessToken);\r\n            this.setAuth(true);\r\n            this.setUser(response.user)\r\n            this.getNotes();\r\n\r\n        } catch (error) {\r\n            return error.response.data;\r\n        }\r\n    }\r\n\r\n    async registration(email, password, name) {\r\n        try {\r\n            const response = await AuthService.registration(email, password, name);\r\n            console.log(response);\r\n            localStorage.setItem('token', response.accessToken);\r\n            this.setAuth(true);\r\n            this.setUser(response.user);\r\n        } catch (error) {\r\n            return error.response.data;\r\n        }\r\n    }\r\n    async logout() {\r\n        try {\r\n            console.log('logout')\r\n            await AuthService.logout();\r\n            localStorage.removeItem('token')\r\n            this.setAuth(false);\r\n            this.setUser({});\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n    }\r\n    async checkAuth() {\r\n        try {\r\n            const response = await AuthService.checkAuth();\r\n            localStorage.setItem('token', response.accessToken)\r\n            this.setAuth(true);\r\n            this.setUser(response.user)\r\n            this.getNotes();\r\n        } catch (error) {\r\n\r\n        }\r\n    }\r\n\r\n    async sendResetPasswordEmail(email) {\r\n        try {\r\n            const response = await AuthService.sendResetPasswordEmail(email);\r\n            console.log(response)\r\n        } catch (error) {\r\n            return error.response.data;\r\n        }\r\n    }\r\n\r\n    //notes\r\n    async getNotes() {\r\n        const LocalNotes = await localdb.getAll()\r\n        this.setNotes(LocalNotes);\r\n        noteService.get().then(res => { //если сервер доступен удаляем заметку из notes и меняем ее на валидную\r\n            if (res.status == 200) {\r\n                res.data.forEach(async serverNote => { //проходимся по каждой заметки из сервера и проверяем по _id есть ли она в локальной бд\r\n                    const isSynced = LocalNotes.find(element => element._id == serverNote._id)\r\n                    if(isSynced == undefined) await localdb.add({...serverNote, status: sync})\r\n                });\r\n\r\n            }\r\n        })\r\n  \r\n    }\r\n    async editNote(note, sync) {\r\n        try {\r\n            //await service.noteChange(editedNote)\r\n            await noteService.edit(note)\r\n            let newArray = [];\r\n            for (let i in this.notes) {\r\n                if (this.notes[i]._id === note._id) {\r\n                    newArray.push(note)\r\n                }\r\n                else {\r\n                    newArray.push(this.notes[i])\r\n                }\r\n            }\r\n            this.setNotes(newArray);\r\n\r\n        } catch (error) {\r\n            console.log(error)\r\n        }\r\n        finally {\r\n        }\r\n\r\n\r\n    }\r\n    async AddNote(note, sync) {\r\n        try {\r\n            // setIsSync(true)\r\n            const localNote = { ...note, status: 'new', _id: new Date() } //сначала создаем заметку в бд\r\n            await localdb.add(localNote)\r\n            this.setNotes([...this.notes, localNote])\r\n            noteService.add(note).then(res => { //если сервер доступен удаляем заметку из notes и меняем ее на валидную\r\n                if (res.status == 200) {\r\n                    const syncNote = res.data;\r\n                    const notes = this.notes.filter(e => e._id !== localNote._id)\r\n                    localdb.delete(localNote._id)\r\n                    localdb.add({...syncNote, status: 'sync'})\r\n                    this.setNotes([...notes, syncNote])\r\n                }\r\n            })\r\n\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n        finally {\r\n            //setIsSync(false)\r\n        }\r\n\r\n    }\r\n    async RemoveNote(note, sync) {\r\n        try {\r\n            await noteService.delete(note)\r\n            const notes = this.notes.filter(e => e._id !== note._id)\r\n            this.setNotes(notes)\r\n        } catch (error) {\r\n\r\n        }\r\n    }\r\n    NoteSearch(search) {\r\n        const notes = this.notes.filter(note => note.title.toLowerCase().includes(search.toLowerCase()))\r\n            .concat(this.notes.filter(note => note.body.toLowerCase().includes(search.toLowerCase())))\r\n        this.setSearchedNotes(notes);\r\n    }\r\n}\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}